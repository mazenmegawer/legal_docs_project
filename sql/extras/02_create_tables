-- Cleanup
DROP TABLE IF EXISTS fatwas CASCADE;
DROP TABLE IF EXISTS judgments CASCADE;
DROP TABLE IF EXISTS legislations CASCADE;
DROP TABLE IF EXISTS documents CASCADE;

-- Recreate tables
-- Core Documents table
CREATE TABLE documents (
    document_id SERIAL PRIMARY KEY,
    doc_type VARCHAR(20) NOT NULL,   -- 'legislation' | 'judgment' | 'fatwa'
    title TEXT,
    created_at TIMESTAMP DEFAULT now(),
    updated_at TIMESTAMP DEFAULT now()
);

-- Fatwas
CREATE TABLE fatwas (
    fatwa_id SERIAL PRIMARY KEY,
    document_id INT NOT NULL REFERENCES documents(document_id) ON DELETE CASCADE,
    file_number VARCHAR(100),
    principle TEXT,
    subject TEXT,
    facts TEXT,
    application TEXT,
    opinion TEXT
);

-- Judgments
CREATE TABLE judgments (
    judgment_id SERIAL PRIMARY KEY,
    document_id INT NOT NULL REFERENCES documents(document_id) ON DELETE CASCADE,
    reference_number VARCHAR(100),   -- رقم الطعن
    appeal_number VARCHAR(100),
    court_name TEXT,
    chamber TEXT,
    principles TEXT,
    facts TEXT,
    reasoning TEXT,
    ruling TEXT,
    session_date DATE                -- تاريخ الجلسة
);

-- Legislations
CREATE TABLE legislations (
    legislation_id SERIAL PRIMARY KEY,
    document_id INT NOT NULL REFERENCES documents(document_id) ON DELETE CASCADE,
    legislation_number VARCHAR(100),
    issue_date DATE,                -- تاريخ الإصدار
    publication_date DATE,
    effective_date DATE,
    source TEXT,
    preamble TEXT,
    articles JSONB,
    signature TEXT
);
